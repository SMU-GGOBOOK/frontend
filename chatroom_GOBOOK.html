
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>교환독서 채팅방</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap');
    * { box-sizing: border-box; }
    body {
      font-family: 'Do Hyeon', sans-serif;
      background: linear-gradient(to right, #f1f8f6, #fce4ec);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background 0.3s ease;
    }
    body.dark { background: #1e1e1e; color: #eee; }
    #chat-container {
      width: 95vw;
      max-width: 1400px;
      height: 90vh;
      display: flex;
      flex-direction: column;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    body.dark #chat-container { background: #2c2c2c; }
    #header {
      background-color: #2D7868;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      font-size: 22px;
    }
    .dark-toggle {
      background: #2D7868;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
    }
    #main-section { display: flex; flex: 1; overflow: hidden; }
    #chat-box {
      flex: 3;
      background: #f5fdfb;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    body.dark #chat-box { background: #3b3b3b; }
    .chat-entry { display: flex; align-items: flex-end; max-width: 100%; }
    .chat-entry.mine { justify-content: flex-end; }
    .chat-entry.bot { justify-content: flex-start; }
    .chat-profile {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid #aaa;
      margin: 0 8px;
    }
    .message {
      position: relative;
      padding: 10px 14px;
      border-radius: 16px;
      max-width: 60%;
      word-break: break-word;
      font-size: 15px;
      display: inline-block;
      background-color: #fff;
    }
    .chat-entry.mine .message {
      background-color: #c6efe1;
      margin-left: 8px;
      color: #1c1c1c;
    }
    body.dark .chat-entry.mine .message {
      background-color: #4a7b70;
      color: #fff;
    }
    .chat-entry.bot .message {
      background-color: #e2e2e2;
      margin-right: 8px;
      color: #1c1c1c;
    }
    body.dark .chat-entry.bot .message {
      background-color: #555;
      color: #fff;
    }
    .message img.chat-image {
      max-width: 120px;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      margin-top: 6px;
    }
    .timestamp {
      display: block;
      font-size: 11px;
      color: #777;
      margin-top: 4px;
      text-align: right;
    }
    #sidebar {
      flex: 1;
      background: #f2f2f2;
      padding: 15px;
      border-left: 1px solid #ccc;
      font-size: 14px;
      color: #2D7868;
      overflow-y: auto;
    }
    .user-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }
    .user-profile {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid #aaa;
    }
    .user-name { flex: 1; font-weight: bold; }
    .kick, .block {
      background-color: #4db6ac;
      border: none;
      border-radius: 20px;
      padding: 4px 8px;
      font-size: 12px;
      color: white;
      cursor: pointer;
    }
    #user-input {
      display: flex;
      flex-direction: column;
      padding: 12px;
      border-top: 1px solid #ddd;
      gap: 10px;
    }
    .input-preview {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #preview {
      max-height: 80px;
      border-radius: 8px;
      border: 1px solid #aaa;
    }
    .input-row {
      display: flex;
      gap: 10px;
    }
    #file-input { display: none; }
    #file-label {
      background-color: #2D7868;
      color: white;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
    }
    #message {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }
    #send {
      background-color: #2D7868;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    #image-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #image-popup img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }
  
body.dark {
  background: #1e1e1e;
  color: white;
}
body.dark #chat-container {
  background: #2a2a2a;
}
body.dark #chat-box {
  background: #1f2d2a;
}
body.dark #sidebar {
  background: #333;
  color: white;
}


.chat-entry.mine .message {
  background-color: #b2f2e4;
  margin-left: 8px;
  color: #1c1c1c;
  border-radius: 20px 20px 0px 20px;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.08);
}
.chat-entry.bot .message {
  background-color: #ffe2f2;
  margin-right: 8px;
  color: #1c1c1c;
  border-radius: 20px 20px 20px 0px;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.08);
}
</style>
</head>
<body>
<div id="chat-container">
<div id="header" style="background-color: #2D7868; color: white; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; font-size: 22px;"><div style="width: 20%;"></div><div style="text-align: center; width: 60%; display: flex; justify-content: center; align-items: center; gap: 20px;"><div>💬 어린왕자 채팅방</div><button id="toggle-dark" style="background:#2D7868;color:white;border:1px solid white;padding:6px 12px;border-radius:10px;font-size:14px;cursor:pointer;">다크모드</button></div><div style="width: 20%; display: flex; justify-content: flex-end;"><button onclick="leaveChat()" style="background:white;color:#2D7868;border:none;padding:6px 12px;border-radius:10px;font-size:14px;cursor:pointer;">나가기</button></div></div>
<div id="main-section">
<div id="chat-box"></div>
<div id="sidebar">
        👥 참여자 목록 (<span id="user-count-number">3</span>명)<br/><br/>
<div id="user-list"></div>
<form id="add-user-form" onsubmit="event.preventDefault(); addUser();">
<label for="add-user-input">+ ID로 유저 추가</label>
<input id="add-user-input" placeholder="예: ggobook93" style="width: calc(100% - 60px); display: inline-block; margin-right: 8px;" type="text"/><button id="add-user-btn" style="display: inline-block; padding: 8px 12px; background: #2D7868; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;" type="submit">추가</button>
</form>
</div>
</div>
<div id="user-input">
<div class="input-preview" id="preview-container" style="display:none">
<img id="preview"/>
</div>
<div class="input-row">
<label for="file-input" id="file-label">📎</label>
<input accept="image/*" id="file-input" type="file"/>
<input id="message" placeholder="메시지를 입력하세요" type="text"/>
<button id="send">보내기</button>
</div>
</div>
<button class="share-btn" onclick="shareRoom()" onmouseout="this.style.background='white'; this.style.color='#2D7868';" onmouseover="this.style.background='#2D7868'; this.style.color='white';" style="background:#ffffff;color:#2D7868;border:1px solid #2D7868;padding:10px 16px;font-size:14px;border-radius:10px;margin:16px auto 12px;display:block;width:fit-content;cursor:pointer;transition: all 0.3s ease;">🔗 채팅방 링크 복사하기</button></div>
<div id="image-popup" onclick="this.style.display='none';">
<img id="popup-img" onwheel="zoomImage(event)" style="transition: transform 0.2s ease;"/>
</div>
<script>
    window.users = ['나(방장)', '뱌뱌뱌', '라떼'];
    const blockedUsers = [];

    const autoReplies = {
      '뱌뱌뱌': ["좋은 생각이에요! 😊", "저도 그렇게 느꼈어요!", "같이 읽으니까 더 재미있네요~"],
      '라떼': ["이 책 너무 좋아요! 🐶", "라떼는 말이죠... 어릴 때부터 책을 좋아했어요!", "간식보다 독서가 좋아요! (진심)"]
    };

    const chatBox = document.getElementById('chat-box');
    const sendButton = document.getElementById('send');
    const messageInput = document.getElementById('message');
    const fileInput = document.getElementById('file-input');
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('preview-container');
    const userList = document.getElementById('user-list');
    const userCount = document.getElementById('user-count-number');
    let imageData = '';

    function updateUserList() {
      userList.innerHTML = '';
      users.forEach(user => {
        const row = document.createElement('div');
        row.className = 'user-row';
        row.innerHTML = `
          <img src="https://via.placeholder.com/32" class="user-profile" />
          <div class="user-name">${user}</div>
          ${user.includes('나') ? '' : `
            <button class="kick" onclick="kickUser('${user}')">강퇴</button>
            <button class="block" onclick="blockUser('${user}')">차단</button>
          `}
        `;
        userList.appendChild(row);
      });
      userCount.textContent = users.length;
    }

    function addUser() {
      const input = document.getElementById('add-user-input');
      const id = input.value.trim();
      if (id && !users.includes(id)) {
        if (!confirm(`${id}님을 추가하시겠습니까?`)) return;
        users.push(id);
        
    let zoomLevel = 1;
    function zoomImage(event) {
      event.preventDefault();
      const img = document.getElementById('popup-img');
      zoomLevel += event.deltaY * -0.001;
      zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 3); // clamp between 0.5 and 3
      img.style.transform = `scale(${zoomLevel})`;
    }

    updateUserList();
        input.value = '';
      }
    }

    function kickUser(name) {
      if (confirm(`${name}님을 강퇴하시겠습니까?`)) {
        const idx = users.indexOf(name);
        if (idx !== -1) {
          users.splice(idx, 1);
          
    let zoomLevel = 1;
    function zoomImage(event) {
      event.preventDefault();
      const img = document.getElementById('popup-img');
      zoomLevel += event.deltaY * -0.001;
      zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 3); // clamp between 0.5 and 3
      img.style.transform = `scale(${zoomLevel})`;
    }

    updateUserList();
          alert(`${name}님이 강퇴되었습니다.`);
        }
      }
    }

    function blockUser(name) {
      if (!confirm(`${name}님을 차단하시겠습니까?`)) return;
      if (!blockedUsers.includes(name)) {
        blockedUsers.push(name);
        alert(`${name}님이 차단되었습니다.`);
      }
    }

    function getCurrentTime() {
      return new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
    }

    function addMessage(text, sender = 'mine', image = '', botName = '') {
      if (blockedUsers.includes('나(방장)') && sender === 'mine') return;

      const entry = document.createElement('div');
      entry.classList.add('chat-entry', sender);
      const profile = document.createElement('img');
      profile.className = 'chat-profile';
      profile.src = 'https://via.placeholder.com/36?text=' + (sender === 'mine' ? '나' : botName);

      const bubble = document.createElement('div');
      bubble.classList.add('message');
      bubble.innerHTML = `<strong>${sender === 'mine' ? '나' : botName}:</strong> ${text}`;
      if (image && image.startsWith('data:image')) {
        const img = document.createElement('img');
        img.src = image;
        img.className = 'chat-image';
        img.setAttribute('onclick', `openImagePopup('${image}')`);
        bubble.appendChild(img);
      }
      bubble.innerHTML += `<div class="timestamp">🕒 ${getCurrentTime()}</div>`;

      if (sender === 'mine') {
        entry.appendChild(bubble);
        entry.appendChild(profile);
      } else {
        entry.appendChild(profile);
        entry.appendChild(bubble);
      }
      chatBox.appendChild(entry);
      chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
    }

    fileInput.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imageData = e.target.result;
          preview.src = imageData;
          previewContainer.style.display = 'flex';
        };
        reader.readAsDataURL(file);
      }
    };

    sendButton.onclick = () => {
      const msg = messageInput.value.trim();
      if (!msg && !imageData) return;

      if (imageData && !confirm('이 이미지를 전송하시겠습니까?')) {
        imageData = '';
        previewContainer.style.display = 'none';
        return;
      }

      addMessage(msg, 'mine', imageData);
      messageInput.value = '';
      previewContainer.style.display = 'none';
      imageData = '';

      setTimeout(() => {
        const bots = Object.keys(autoReplies);
        const randomBot = bots[Math.floor(Math.random() * bots.length)];
        const replyList = autoReplies[randomBot];
        const reply = replyList[Math.floor(Math.random() * replyList.length)];
        addMessage(reply, 'bot', '', randomBot);
      }, 1000);
    };

    messageInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendButton.click();
      }
    });

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function openImagePopup(src) {
      const popup = document.getElementById('image-popup');
      const popupImg = document.getElementById('popup-img');
      popupImg.src = src;
      popup.style.display = 'flex';
    }

    
    let zoomLevel = 1;
    function zoomImage(event) {
      event.preventDefault();
      const img = document.getElementById('popup-img');
      zoomLevel += event.deltaY * -0.001;
      zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 3); // clamp between 0.5 and 3
      img.style.transform = `scale(${zoomLevel})`;
    }

    updateUserList();
  </script>
<script>
  let zoomLevel = 1;
  function zoomImage(event) {
    event.preventDefault();
    const img = document.getElementById('popup-img');
    zoomLevel += event.deltaY * -0.001;
    zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 3);
    img.style.transform = `scale(${zoomLevel}) translate(0px, 0px)`;
  }

  let isDragging = false;
  let startX, startY, initialX = 0, initialY = 0;

  const popupImg = document.getElementById('popup-img');
  popupImg.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    popupImg.style.cursor = 'grabbing';
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    popupImg.style.cursor = 'grab';
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    popupImg.style.transform = `scale(${zoomLevel}) translate(${dx}px, ${dy}px)`;
  });
</script>
<script>
  const toggleDark = document.getElementById('toggle-dark');
  toggleDark.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    toggleDark.textContent = document.body.classList.contains('dark') ? '라이트모드' : '다크모드';
  });
</script>
<script>
  function showProfile(name, image) {
    const popup = document.createElement('div');
    popup.id = 'profile-popup';
    popup.style.position = 'fixed';
    popup.style.top = '50%';
    popup.style.left = '50%';
    popup.style.transform = 'translate(-50%, -50%)';
    popup.style.background = 'white';
    popup.style.color = '#333';
    popup.style.border = '1px solid #aaa';
    popup.style.borderRadius = '10px';
    popup.style.padding = '20px';
    popup.style.zIndex = '9999';
    popup.innerHTML = `
      <div style="text-align:center;">
        <img src="${image}" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;" />
        <h3 style="margin:5px 0;">${name}</h3><p style="font-size:13px;color:#666;">ID: ${name.toLowerCase()}</p>
        <p>추가 정보는 여기에 표시됩니다.</p>
        <button onclick="document.body.removeChild(document.getElementById('profile-popup'))"
                style="margin-top:10px;padding:6px 12px;background:#2D7868;color:white;border:none;border-radius:6px;">닫기</button>
      </div>
    `;
    document.body.appendChild(popup);
  }
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const imgPopup = document.getElementById("image-popup");
  const popupImage = document.getElementById("popup-image");

  let isDragging = false, startX, startY, scrollLeft, scrollTop;

  if (popupImage && imgPopup) {
    popupImage.addEventListener("mousedown", (e) => {
      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      scrollLeft = imgPopup.scrollLeft;
      scrollTop = imgPopup.scrollTop;
      popupImage.style.cursor = "grabbing";
    });

    imgPopup.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      const x = e.clientX;
      const y = e.clientY;
      const walkX = (x - startX);
      const walkY = (y - startY);
      imgPopup.scrollLeft = scrollLeft - walkX;
      imgPopup.scrollTop = scrollTop - walkY;
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
      popupImage.style.cursor = "grab";
    });
  }
});
</script>


<script>
  const addUserForm = document.getElementById('add-user-form');
  const addUserInput = document.getElementById('add-user-input');
  const addUserButton = document.getElementById('add-user-button');
  const userList = document.getElementById('user-list');
  const userCount = document.getElementById('user-count-number');
  let users = ['나(방장)', '뱌뱌뱌', '라떼'];

  function updateUserList() {
    userList.innerHTML = '';
    users.forEach(user => {
      const row = document.createElement('div');
      row.className = 'user-row';
      if (user.includes('나')) {
        row.innerHTML = `<div class="user-name">• ${user}</div>`;
      } else {
        row.innerHTML = `<div class="user-name">• ${user}</div>
          <div>
            <button class="kick">강퇴</button>
            <button class="block">차단</button>
          </div>`;
      }
      userList.appendChild(row);
    });
    userCount.textContent = users.length;
  }

  if (addUserButton) {
    addUserButton.addEventListener("click", function(e) {
      e.preventDefault();
      const id = addUserInput.value.trim();
      if (!id) return;

      const normalizedId = id.toLowerCase();
      const normalizedUsers = users.map(u => u.trim().toLowerCase());

      if (normalizedUsers.includes(normalizedId)) {
        alert("이미 입장한 유저입니다.");
        return;
      }

      if (confirm("추가하시겠습니까?")) {
        users.push(id);
        updateUserList();
        addUserInput.value = '';
      }
    });
  }

  updateUserList();
</script>
</body>
</html>
