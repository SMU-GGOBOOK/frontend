<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <ul class="file_list"></ul>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const fileList = document.querySelector('.file_list');
  const MAX_FILES = 5;

  function generateId() {
    return 'file_' + Math.random().toString(36).slice(2);
  }

  function createFileItem() {
    const id = generateId();
    const li = document.createElement('li');
    li.classList.add('list_item');
    li.innerHTML = `
      <span class="file_item">
        <span class="btn_box">
          <input id="${id}" type="file" accept="image/*">
          <label for="${id}">
            <span class="hidden">첨부파일 추가</span>
          </label>
          <span class="attach_img_box" style="display: none;">
            <span class="attach_img_view"></span>
            <button class="btn_remove_img" type="button">
              <span class="hidden">첨부파일 삭제</span>
            </button>
          </span>
        </span>
      </span>
    `;

    fileList.appendChild(li);

    const input = li.querySelector('input[type="file"]');
    const attachBox = li.querySelector('.attach_img_box');
    const preview = li.querySelector('.attach_img_view');
    const fileItem = li.querySelector('.file_item');
    const removeBtn = li.querySelector('.btn_remove_img');

    input.addEventListener('change', () => {
      const file = input.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const imageUrl = e.target.result;

          preview.setAttribute(
            "style",
            `background-image: url("${imageUrl}");`
          );
          fileItem.classList.add('attached');
          attachBox.style.display = 'inline-block';

          if (fileList.children.length < MAX_FILES) {
            createFileItem();
          }
        };
        reader.readAsDataURL(file);
      } else {
        alert('이미지 파일(JPG, PNG, GIF)만 업로드 가능합니다.');
        input.value = '';
      }
    });

    removeBtn.addEventListener('click', () => {
      li.remove();

      if (
        fileList.querySelectorAll('li').length < MAX_FILES &&
        (!fileList.lastElementChild || !fileList.lastElementChild.querySelector('input').value)
      ) {
        createFileItem();
      }
    });
  }

  if (fileList.children.length === 0) {
    createFileItem();
  }
});
</script>

</body>
</html>